{
	"name": "PricePaid",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "GeoBlobDest",
						"type": "DatasetReference"
					},
					"name": "GeoPostCodes"
				},
				{
					"dataset": {
						"referenceName": "CompanyDataBlob",
						"type": "DatasetReference"
					},
					"name": "Companies"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "GeoData"
				},
				{
					"name": "Join1"
				},
				{
					"name": "Aggregate1"
				}
			],
			"script": "source(output(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string,\n\t\tColumn_7 as string,\n\t\tColumn_8 as string,\n\t\tColumn_9 as string,\n\t\tColumn_10 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\twildcardPaths:['processed/']) ~> GeoPostCodes\nsource(output(\n\t\tCompanyName as string,\n\t\tCompanyNumber as string,\n\t\t{RegAddress.CareOf} as string,\n\t\t{RegAddress.POBox} as string,\n\t\t{RegAddress.AddressLine1} as string,\n\t\t{RegAddress.AddressLine2} as string,\n\t\t{RegAddress.PostTown} as string,\n\t\t{RegAddress.County} as string,\n\t\t{RegAddress.Country} as string,\n\t\t{RegAddress.PostCode} as string,\n\t\tCompanyCategory as string,\n\t\tCompanyStatus as string,\n\t\tCountryOfOrigin as string,\n\t\tDissolutionDate as string,\n\t\tIncorporationDate as string,\n\t\t{Accounts.AccountRefDay} as string,\n\t\t{Accounts.AccountRefMonth} as string,\n\t\t{Accounts.NextDueDate} as string,\n\t\t{Accounts.LastMadeUpDate} as string,\n\t\t{Accounts.AccountCategory} as string,\n\t\t{Returns.NextDueDate} as string,\n\t\t{Returns.LastMadeUpDate} as string,\n\t\t{Mortgages.NumMortCharges} as string,\n\t\t{Mortgages.NumMortOutstanding} as string,\n\t\t{Mortgages.NumMortPartSatisfied} as string,\n\t\t{Mortgages.NumMortSatisfied} as string,\n\t\t{SICCode.SicText_1} as string,\n\t\t{SICCode.SicText_2} as string,\n\t\t{SICCode.SicText_3} as string,\n\t\t{SICCode.SicText_4} as string,\n\t\t{LimitedPartnerships.NumGenPartners} as string,\n\t\t{LimitedPartnerships.NumLimPartners} as string,\n\t\tURI as string,\n\t\t{PreviousName_1.CONDATE} as string,\n\t\t{PreviousName_1.CompanyName} as string,\n\t\t{PreviousName_2.CONDATE} as string,\n\t\t{PreviousName_2.CompanyName} as string,\n\t\t{PreviousName_3.CONDATE} as string,\n\t\t{PreviousName_3.CompanyName} as string,\n\t\t{PreviousName_4.CONDATE} as string,\n\t\t{PreviousName_4.CompanyName} as string,\n\t\t{PreviousName_5.CONDATE} as string,\n\t\t{PreviousName_5.CompanyName} as string,\n\t\t{PreviousName_6.CONDATE} as string,\n\t\t{PreviousName_6.CompanyName} as string,\n\t\t{PreviousName_7.CONDATE} as string,\n\t\t{PreviousName_7.CompanyName} as string,\n\t\t{PreviousName_8.CONDATE} as string,\n\t\t{PreviousName_8.CompanyName} as string,\n\t\t{PreviousName_9.CONDATE} as string,\n\t\t{PreviousName_9.CompanyName} as string,\n\t\t{PreviousName_10.CONDATE} as string,\n\t\t{PreviousName_10.CompanyName} as string,\n\t\tConfStmtNextDueDate as string,\n\t\tConfStmtLastMadeUpDate as string,\n\t\tFilename as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> Companies\nGeoPostCodes select(mapColumn(\n\t\tPostcode = Column_1,\n\t\tPositional_quality_indicator = Column_2,\n\t\tEastings = Column_3,\n\t\tNorthings = Column_4,\n\t\tCountry_code = Column_5,\n\t\tNHS_regional_HA_code = Column_6,\n\t\tNHS_HA_code = Column_7,\n\t\tAdmin_county_code = Column_8,\n\t\tAdmin_district_code = Column_9,\n\t\tAdmin_ward_code = Column_10\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> GeoData\nGeoData, Companies join(Postcode == {RegAddress.PostCode},\n\tjoinType:'left',\n\tbroadcast: 'off')~> Join1\nJoin1 aggregate(groupBy(Postcode,\n\t\tCountry_code),\n\tPostcode = ERROR_FUNCTION('')) ~> Aggregate1"
		}
	}
}